{"name":"Robinchenyu.GitHub.io","tagline":"vim ctrlp","body":"# 让ctrlp支持工程目录\r\n  ctrlp这个插件非常好用,唯一不足的是,如果工程文件是多级目录时,显得不是那么灵活.理想的是在工程文件时,调用ctrlp会自动把工程目录作为基本目录,在其子目录中查找文件.\r\n\r\n## 增加函数FindProjDir如下:\r\n```vimscript\r\n\" vimrc\r\nfunction! FindProjDir()\r\n    let cur_dir = getcwd()\r\n    let myprojects = {\"xercesc\": \".\\\\+src.xercesc\",\r\n                \\ \"oa\": \".\\\\+Env.\\\\+oa.\\\\+project\"}\r\n\r\n    for [key,val] in items(myprojects)\r\n        if cur_dir =~ val\r\n            echom \"find project: \" . key\r\n            return [key, matchstr(cur_dir, val)]\r\n        endif\r\n    endfor\r\n    echom \"no project\"\r\n    return [\"unknown\", cur_dir]\r\nendfunction\r\n```\r\n## 修改ctrlp.vim\r\n```vimscript\r\n\" - SetWD() {{{1\r\nfu! s:SetWD(args)\r\n\tif has_key(a:args, 'args') && stridx(a:args['args'], '--dir') >= 0\r\n\t\t\\ && exists('s:dyncwd')\r\n\t\tcal ctrlp#setdir(s:dyncwd) | retu\r\n\ten\r\n\tif has_key(a:args, 'dir') && a:args['dir'] != ''\r\n\t\tcal ctrlp#setdir(a:args['dir']) | retu\r\n\ten\r\n\tlet pmode = has_key(a:args, 'mode') ? a:args['mode'] : s:pathmode\r\n\tlet [s:crfilerel, s:dyncwd] = [fnamemodify(s:crfile, ':.'), getcwd()]\r\n\tif s:crfile =~ '^.\\+://' | retu | en\r\n\tif pmode =~ 'c' || ( pmode =~ 'a' && stridx(s:crfpath, s:cwd) < 0 )\r\n\t\t\\ || ( !type(pmode) && pmode )\r\n\t\tif exists('+acd') | let [s:glb_acd, &acd] = [&acd, 0] | en\r\n+    let [project_name, project_dir] = FindProjDir()\r\n+    if project_name == 'unknown'\r\n+\t\t  cal ctrlp#setdir(s:crfpath)\r\n+    else\r\n      call ctrlp#setdir(project_dir)\r\n+    endif\r\n\ten\r\n\tif pmode =~ 'r' || pmode == 2\r\n\t\tlet markers = ['.git', '.hg', '.svn', '.bzr', '_darcs']\r\n\t\tlet spath = pmode =~ 'd' ? s:dyncwd : pmode =~ 'w' ? s:cwd : s:crfpath\r\n\t\tif type(s:rmarkers) == 3 && !empty(s:rmarkers)\r\n\t\t\tif s:findroot(spath, s:rmarkers, 0, 0) != [] | retu | en\r\n\t\t\tcal filter(markers, 'index(s:rmarkers, v:val) < 0')\r\n\t\ten\r\n\t\tcal s:findroot(spath, markers, 0, 0)\r\n\ten\r\nendf\r\n```","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}