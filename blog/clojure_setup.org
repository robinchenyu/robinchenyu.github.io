#+TITLE:       Clojure安装及配置
#+AUTHOR:
#+EMAIL:       robin.chenyu@gmail.com
#+DATE:        2017-02-01 Wen
#+URI:         /blog/%y/%m/%d/clojure安装及配置
#+KEYWORDS:    clojure, install, emacs, setup
#+TAGS:        clojure, install, setup
#+LANGUAGE:    en
#+OPTIONS:     H:3 num:nil toc:nil \n:nil ::t |:t ^:nil -:nil f:t *:t <:t
#+DESCRIPTION: Clojure的安装及配置

* clojure配置repl端口和repo路径

** 修改repo默认路径
  在windows下lein的默认三方包存放路径在%USERPROFIL%/.m2下,windows下的此路径一般是C:/Document and Settings/user,但是lein和emacs在处理路径中的空格时常常出错

  1. 在工程的project.clj里添加如下配置
     #+BEGIN_SRC clojure
       :local-repo "d:\\home\\clojure\\.m2"
       ;Location of locally installed jars
       ;(that can't be downloaded from public repo's)
       :repositories  {"local" {:url "file://d:\\home\\clojure\\.m2"
                                :releases {:checksum :ignore}}}
       :repl-options {:port 30000}
     #+END_SRC

  2. 解决方法2,在~/.lein/profiles.clj下添加
     #+BEGIN_SRC clojure
          {:user  {;Location of local repository
           :local-repo "d:\\home\\clojure\\.m2"
           ;Location of locally installed jars
           ;(that can't be downloaded from public repo's)
           :repositories  {"local" {:url "file://d:\\home\\clojure\\.m2"
                                    :releases {:checksum :ignore}}}
           {:plugins [[lein-pprint "1.1.1"]]
            :dependencies [[slamhound "1.3.1"]]}
            :repl-options {:port 30000}}}
     #+END_SRC

** emacs中设置nrepl默认端口
   添加配置, 同时需要修改`cider.el`中=cider-select-endpoint=函数
   #+BEGIN_SRC diff
   (setq cider-known-endpoints '(("X240" "localhost" "30000")))

   ;; 
   (defun cider-select-endpoint ()
  "Interactively select the host and port to connect to."
  (dolist (endpoint cider-known-endpoints)
    (unless (stringp (or (nth 2 endpoint)
                         (nth 1 endpoint)))
      (user-error "The port for %s in `cider-known-endpoints' should be a string"
                  (nth 0 endpoint))))
  (let* ((ssh-hosts (cider--ssh-hosts))
         (hosts (seq-uniq (append (when cider-host-history
                                    ;; history elements are strings of the form "host:port"
                                    (list (split-string (car cider-host-history) ":")))
                                  (list (list (cider-current-host)))
                                  cider-known-endpoints
                                  ssh-hosts
                                  (when (file-remote-p default-directory)
                                    ;; add localhost even in remote buffers
                                    '(("localhost"))))))
         (sel-host (cider--completing-read-host hosts))
         (host (car sel-host))
         (port (or (cadr sel-host)
                   (cider--completing-read-port host (cider--infer-ports host ssh-hosts)))))
+    (if (stringp port)
+        (setq port (string-to-int port)))
    (list host port)))
   #+END_SRC

*** clojure常用库
    ~lein-try~ 是一个非常有用的库。比如在了解 ~clj-time~ 中的新方法时，遇到困难，需要测试，使用 ~lein-try~ 不需要新建一个工程，
    再在工程中添加 ~lein-try~, 直接在使用 ~lein try clj-time~ 就可以了。
    安装方式, 在 _.lein/profiles.clj_ 中添加如下:
    #+BEGIN_SRC clojure
    {:user {:plugins [[lein-try "0.4.1"]]}}
    #+END_SRC
    

